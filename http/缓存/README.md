## 浏览器缓存的优点  
- 加快浏览器加载网页速度
- 减少服务器压力

## 缓存资源放在什么地方  

- memory cache  
  MemoryCache 就是缓存资源副本到内存中，下次访问时不用重新下载资源，而是直接从内存中取。如浏览器引擎 webkit资源分成两类，一个是主资源，MainResourceCache 如 html文件，还有派生资源 SubResourceCache如嵌入html中的js css img等静态资源

- dist cache  
  将资源缓存到磁盘上  

- dist cache & memory cache对比  

|       | dist cache | memory cache |
|  ---- | ----- | --------|
|存储内容|js css |  非脚本内容 如 css|
|存放位置| 磁盘 | 内存 |
|||||

## 缓存读取的优先级  

- 首先从内存中查找缓存，如果有直接加载  
- 如果内存中没有，去硬盘中查找，如果有直接加载
- 如果硬盘上没有，发起网络请求
- 请求获取资源缓存到硬盘  

## 浏览器缓存分类 

- 强缓存  
  强缓存是利用http的响应头中Expires或者Cache-Control两个字段控制的十分命中强缓存，命中直接获取，包含缓存的header信息，本次请求不会与资源服务器进行通信  
  
  强缓存相关的响应头字段：  
  1. expires 是http1.0的规范。值是一个觉得的时间字符串，如Expires: Wed, 27 Nov 2019 04:30:33 GMT  代表资源失效的时间，在此时间之前，即命中缓存。使用觉得时间有个弊端就是客户端和服务端时间偏差大的话会导致缓存混乱  
  2. Cache-Control http1.1 出现的header信息。 如：cache-control: max-age=315360000  主要利用max-age字段的值进行判断，是个相对时间，单位是秒  
  3. 如果同时出现这两个字段 Cache-Control 优先级大于 Expires

- 协商缓存  

  对于没有命中强缓存的，请求会发送到服务器，请求会携带上次请求的缓存相关的header字段信息（如 Last-Modified/IF-Modified-Since, Etag/IF-None-Mache）,服务器判断是否命中协商缓存，如命中，服务器更新响应头header中缓存信息，不会返回资源内容，返回码304,资源从缓存服务器中获取。否则返回最新内容。 

  协商缓存相关的响应字段：  
  1. last-modified/if-modify-since  
    浏览器请求一个资源的时候，服务器响应头中添加 last-modified字段如last-modified: Wed, 13 Nov 2019 09:07:13 GMT，代表资源修改的最后时间。浏览器或者客户端再次请求该资源时，请求头包含一个If-Modified-Since字段（If-Modified-Since: Fri, 05 Jan 2018 01:16:04 GMT），这个值就是上一次请求返回的last-modified.服务器接收到这个字段取出这个时间，与服务器资源最后的修改时间做一下对比，判断是否命中缓存。If-Modified-Since的时间早于资源修改的时间，说明资源修改了，返回新的资源，并且返回last-modified最新的资源修改时间到客户端；否则返回码304，服务不返回资源内容，从缓存中返回资源。  
    缺点： 举个例子，资源版本是v1, 过段时间修改内容，资源版本v2,在过一会 修改内容和v1版本内容一样。这个请求其实，资源更新时间一直会变，但是请求的内容未必更改了，导致不走缓存策略了。于是出现了更好的策略 Etag
  2. etag/If-None-Match
    （如If-None-Match: "30ee4e559c8e212f1e58e6fd893e4f07"，ETag: "30ee4e559c8e212f1e58e6fd893e4f07"）
    如上面所示 这连个字段内容是一串字符串（资源内容生成的hash值）。Etag保证每个资源是唯一的，资源内容变了会导致Etag变化。客户端请求资源的时候，服务器响应头中会返回etag资源指纹（就是那个hash串），再次请求时请求头会携带If-None-Match，值为上次etag返回的值。到服务值后两个hash值对比。如果相同命中协商缓存，返回码304，资源从缓存中取。
  
  3. etag & last-modified 比较  
    如果同时出现 etag优先级更高，etag文件指纹，唯一的。  
  
- 协商缓存和强缓存对比  

||获取资源形式|状态码| 是否发送请求到服务器|
| ------ | ----- | ---- | ---- |
|强缓存| 从缓存中取|200(from cache)|否|
|协商缓存|从缓存中取|304(not modified)|是|


整个http缓存策略就是，先判断是否命中强缓存，再判断是否命中协商缓存。充分利用缓存，可以很好的做到性能优化。


  